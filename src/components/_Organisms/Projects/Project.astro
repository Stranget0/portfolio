---
import SectionFloatingImages from "@components/SlidedSection/_SectionFloatingImages.astro";
import SectionFullscreenImages from "@components/SlidedSection/_SectionFullscreenImages.astro";
import SectionItem from "@components/SlidedSection/_SectionItem.astro";
import SectionItemDescription from "@components/SlidedSection/_SectionItemDescription.astro";
import SectionItemTitle from "@components/SlidedSection/_SectionItemTitle.astro";
import type {  CollectionEntry } from "astro:content";
import SectionFloatingImagesReferences from "@components/SlidedSection/_SectionFloatingImagesReferences.astro";
import SectionLinks from "@components/SlidedSection/_SectionLinks.astro";
import SectionHeading from "@components/SlidedSection/_SectionHeading.astro";
import SectionYear from "@components/SlidedSection/_SectionYear.astro";
import AppearingText from "@components/AppearingText/AppearingText.astro";
import { forceFocusViewAttrObj } from "@plugins/forceFocusView/constants";
import { preloadImagesInContainer } from "@plugins/preloadImagesInContainer/serverUtils";

interface Props {
	frontmatter: CollectionEntry<"projects">;
}

const { frontmatter } = Astro.props;
const { data, render, slug, id } = frontmatter;
const {
	fullscreenImages,
	floatingImages,
	title,
	description:_description,
	audioTextTimings,
	startYear,
	endYear,
	class: className = "bg-primary-50 color-var-primary-900",
	titleClass,
	github,
	website,
} = data;


const hasFullscreenImages = !!fullscreenImages?.length;
const hasFloatingImages = !!floatingImages?.length;

const isScrollRefFeature = true;


const { Content } = await render();
---

<SectionItem
	id={slug}
	class={className}
	data-scroll-feature-refs={isScrollRefFeature ? true : undefined}
	{...preloadImagesInContainer}
	{...forceFocusViewAttrObj}
>
	<!-- <SectionTopFixed>
		<SectionYear startYear={startYear} endYear={endYear} />
	</SectionTopFixed> -->
	<AppearingText
		wordTimings={audioTextTimings || []}
		wordsReference={[]}
		audioPath=""
		id={id}
	>
		{title && <SectionItemTitle title={title} class={titleClass} />}
		<SectionItemDescription>
			<SectionYear startYear={startYear} endYear={endYear} />
			<Content
				components={{
					h1: SectionHeading,
				}}
			/>
		</SectionItemDescription>
	</AppearingText>
	
	{
		hasFullscreenImages && (
			<SectionFullscreenImages
			images={fullscreenImages}
				floatingImages={floatingImages}
				/>
				)
			}
	{hasFloatingImages && <SectionFloatingImages images={floatingImages} />}
	{
		hasFloatingImages && (
			<SectionFloatingImagesReferences images={floatingImages} />
		)
	}

	<div class="fixed bottom-4">
		<SectionLinks website={website} github={github} class="w-full" />
	</div>
</SectionItem>

<script>
	import importInView from "@utils/importInView/importInView";
	importInView(
		"scroll-reference",
		() => import("@components/_CustomElements/ScrollReference")
	);
</script>
