---
import { getCollection, getEntryBySlug } from "astro:content";
import Technologies from "@components/Technologies.astro";
import AppearingLine from "@components/AppearingText/AppearingLine.astro";
import sortTechnologies from "@utils/sortTechnologies";
import partition from "lodash/partition";
import chunk from "lodash/chunk";
import { mainpageTabs } from "@/constants";
import { foxObstacleAttrObj } from "@components/ThreeScene/constants";

const techCollection = await getCollection("technologies");

const technologies = sortTechnologies(
	await Promise.all(
		techCollection.map(({ slug }) => getEntryBySlug("technologies", slug))
	)
);

const techsArr = partition(
	technologies,
	({ data }) => data.importance < 10
).flatMap((arr) => chunk(arr, 5));
---

{
	!!technologies.length && (
		<section
			id={mainpageTabs.skills.id}
			class="section min-h-screen block relative overflow-hidden max-w-full prose pb-20 bg-primary-200 isolate before:(bg-primary-300 pseudo-full inset-4 top-12 bottom-12 md:inset-12 rounded-4 solid-shadow b-4 b-current)"
			data-static-h="100vh"
			data-static-h-type="min"
			{...foxObstacleAttrObj}
		>
			<article
				class="w-full pt-4 pb-6 pb-40 text-center"
				data-scroll-target-ref
			>
				<AppearingLine
					as="h2"
					text="Skills"
					class="text-subtitle-1 mb-20 mx-auto solid-text-shadow relative p-y-4 before:(pseudo-full b-t-4 b-b-4 b-current)"
					lettersTransition
				/>
				<div class="flex flex-wrap gap-8">
					{techsArr.map((tech) => {
						return (
							<Technologies
								entries={tech}
								defaultColor="#ffffff"
								class="justify-center flex-col mx-auto"
								chipClass="grayscale-50 solid-shadow md:grayscale-75 list-none md:hover:grayscale-0 motion-safe:transition-filter-600"
							/>
						);
					})}
				</div>
			</article>
		</section>
	)
}
